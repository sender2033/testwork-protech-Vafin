![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-27.10.2025-23_49.png?raw=true)

# Настройка роутеров

Настройка  Router 1 (Edge Router)
```
[admin@MikroTik] > /ip dhcp-client print
Flags: X - disabled, I - invalid, D - dynamic
 #   INTERFACE                                                    USE-PEER-DNS ADD-DEFAULT-ROUTE STATUS        ADDRESS
 0   ether1                                                       yes          yes               bound         192.168.209.139/24
[admin@MikroTik] > /interface print
Flags: D - dynamic, X - disabled, R - running, S - slave
 #     NAME                                TYPE       ACTUAL-MTU L2MTU  MAX-L2MTU MAC-ADDRESS
 0  R  ether1                              ether            1500                  50:18:80:00:3D:00
 1  R  ether2                              ether            1500                  50:18:80:00:3D:01
 2  R  ether3                              ether            1500                  50:18:80:00:3D:02
 3  R  ether4                              ether            1500                  50:18:80:00:3D:03
[admin@MikroTik] > /interface vlan
[admin@MikroTik] /interface vlan> add interface=eth2 vlan-id=10 name=VLAN10 comment="Client Network Trunk"
input does not match any value of interface
[admin@MikroTik] /interface vlan> add interface=ether2 vlan-id=10 name=VLAN10 comment="Client Network Trunk"
[admin@MikroTik] /interface vlan> add interface=ether2 vlan-id=20 name=VLAN20 comment="Server Network Trunk"
[admin@MikroTik] /interface vlan> /ip address
[admin@MikroTik] /ip address> add address=172.16.2.254/24 interface=VLAN20 comment="Management"
[admin@MikroTik] /ip address> /ip firewall nat
[admin@MikroTik] /ip firewall nat> add chain=srcnat out-interface=ether1 action=masquerade comment="NAT to Internet"
[admin@MikroTik] /ip firewall nat> /ip firewall filter
[admin@MikroTik] /ip firewall filter> add chain=forward action=accept connection-state=established,related comment="Allow established"
[admin@MikroTik] /ip firewall filter> add chain=forward action=accept in-interface=VLAN10 out-interface=ether1 comment="VLAN10 to Internet"
[admin@MikroTik] /ip firewall filter> add chain=forward action=accept in-interface=VLAN20 out-interface=ether1 comment="VLAN20 to Internet"
[admin@MikroTik] /ip firewall filter> add chain=forward action=accept in-interface=VLAN10 out-interface=VLAN20 comment="VLAN10 to VLAN20"
[admin@MikroTik] /ip firewall filter> add chain=forward action=accept in-interface=VLAN20 out-interface=VLAN10 comment="VLAN20 to VLAN10"
[admin@MikroTik] /ip firewall filter> /ip dns
[admin@MikroTik] /ip dns> set servers=8.8.8.8,1.1.1.1 allow-remote-requests=yes
[admin@MikroTik] /ip dns> /interface print
Flags: D - dynamic, X - disabled, R - running, S - slave
 #     NAME                                TYPE       ACTUAL-MTU L2MTU  MAX-L2MTU MAC-ADDRESS
 0  R  ether1                              ether            1500                  50:18:80:00:3D:00
 1  R  ether2                              ether            1500                  50:18:80:00:3D:01
 2  R  ether3                              ether            1500                  50:18:80:00:3D:02
 3  R  ether4                              ether            1500                  50:18:80:00:3D:03
 4  R  ;;; Client Network Trunk
       VLAN10                              vlan             1500                  50:18:80:00:3D:01
 5  R  ;;; Server Network Trunk
       VLAN20                              vlan             1500                  50:18:80:00:3D:01
[admin@MikroTik] /ip dns> /ip address print
Flags: X - disabled, I - invalid, D - dynamic
 #   ADDRESS            NETWORK         INTERFACE
 0 D 192.168.209.139/24 192.168.209.0   ether1
 1   ;;; Management
     172.16.2.254/24    172.16.2.0      VLAN20
[admin@MikroTik] /ip dns> /ip route print
Flags: X - disabled, A - active, D - dynamic, C - connect, S - static, r - rip, b - bgp, o - ospf, m - mme,
B - blackhole, U - unreachable, P - prohibit
 #      DST-ADDRESS        PREF-SRC        GATEWAY            DISTANCE
 0 ADS  0.0.0.0/0                          192.168.209.2             1
 1 ADC  172.16.2.0/24      172.16.2.254    VLAN20                    0
 2 ADC  192.168.209.0/24   192.168.209.139 ether1                    0
[admin@MikroTik] /ip dns> /user add name=oxidized password=Oxidized123! group=full comment="Oxidized Backup User"
[admin@MikroTik] /ip dns> ..
[admin@MikroTik] /ip> ..
[admin@MikroTik] > /ip service
[admin@MikroTik] /ip service> set ssh address=172.16.2.0/24 port=22
[admin@MikroTik] /ip service> set telnet disabled=yes
[admin@MikroTik] /ip service> /user print
Flags: E - expired, X - disabled
 #    NAME                                      GROUP                                     ADDRESS            LAST-LOGGED-IN
 0    ;;; system default user
      admin                                     full
 1    ;;; Oxidized Backup User
      oxidized                                  full
[admin@MikroTik] /ip service> /ip service print
Flags: X - disabled, I - invalid
 #   NAME                      PORT ADDRESS                                                        CERTIFICATE
 0 XI telnet                      23
 1   ftp                         21
 2   www                         80
 3   ssh                         22 172.16.2.0/24
 4 XI www-ssl                    443                                                                none
 5   api                       8728
 6   winbox                    8291
 7   api-ssl                   8729                                                                none
[admin@MikroTik] /ip service>

```

---

Настройка Router 2 (Core Router-on-Stick)
```
[admin@MikroTik] > /interface vlan
[admin@MikroTik] /interface vlan> add interface=ether2 vlan-id=10 name=VLAN10 comment="Client Network"
[admin@MikroTik] /interface vlan> add interface=ether2 vlan-id=20 name=VLAN20 comment="Server Network"
[admin@MikroTik] /interface vlan> /ip address
[admin@MikroTik] /ip address> add address=172.16.1.1/24 interface=VLAN10 comment="VLAN10 Gateway"
[admin@MikroTik] /ip address> add address=172.16.2.1/24 interface=VLAN20 comment="VLAN20 Gateway"
[admin@MikroTik] /ip address> add address=172.16.2.254/24 interface=ether1 comment="Syslog to Linux SERVER"
[admin@MikroTik] /ip address> /interface bridge
[admin@MikroTik] /interface bridge> add name=bridge-vlan10 comment="VLAN 10 Bridge"
[admin@MikroTik] /interface bridge> add name=bridge-vlan20 comment="VLAN 20 Bridge"
[admin@MikroTik] /interface bridge> /interface bridge port
[admin@MikroTik] /interface bridge port> add bridge=bridge-vlan10 interface=VLAN10
[admin@MikroTik] /interface bridge port> add bridge=bridge-vlan10 interface=ether3 comment="Linux Client 1"
[admin@MikroTik] /interface bridge port> add bridge=bridge-vlan20 interface=VLAN20
[admin@MikroTik] /interface bridge port> add bridge=bridge-vlan20 interface=ether4 comment="Windows Server"
[admin@MikroTik] /interface bridge port> add bridge=bridge-vlan20 interface=ether5 comment="Linux SERVER e1"
[admin@MikroTik] /interface bridge port> add bridge=bridge-vlan20 interface=ether1 comment="Linux SERVER e0 Syslog"
[admin@MikroTik] /interface bridge port> /ip address
[admin@MikroTik] /ip address> remove [find interface=VLAN10]
[admin@MikroTik] /ip address> remove [find interface=VLAN20]
[admin@MikroTik] /ip address> add address=172.16.1.1/24 interface=bridge-vlan10 comment="VLAN10 Gateway"
[admin@MikroTik] /ip address> add address=172.16.2.1/24 interface=bridge-vlan20 comment="VLAN20 Gateway"
[admin@MikroTik] /ip address> /ip route
[admin@MikroTik] /ip route> add dst-address=0.0.0.0/0 gateway=172.16.2.254 comment="Default via Router 1"
[admin@MikroTik] /ip route> /ip dns
[admin@MikroTik] /ip dns> set servers=172.16.2.2 allow-remote-requests=yes
[admin@MikroTik] /ip dns> /ip firewall filter
[admin@MikroTik] /ip firewall filter> add chain=forward action=accept connection-state=established,related comment="Allow established"
[admin@MikroTik] /ip firewall filter> add chain=forward action=accept comment="Allow all forwarding for lab"
[admin@MikroTik] /ip firewall filter> /system logging action
[admin@MikroTik] /system logging action> add name=remote target=remote remote=172.16.2.3 remote-port=514
failure: action already exists with such a name
[admin@MikroTik] /system logging action> add name=remote1 target=remote remote=172.16.2.3 remote-port=514
[admin@MikroTik] /system logging action> /system logging
[admin@MikroTik] /system logging> add action=remote1 topics=info,!debug
[admin@MikroTik] /system logging> add action=remote1 topics=warning
[admin@MikroTik] /system logging> add action=remote1 topics=error
[admin@MikroTik] /system logging> add action=remote1 topics=critical
[admin@MikroTik] /system logging> /interface print
Flags: D - dynamic, X - disabled, R - running, S - slave
 #     NAME                                TYPE       ACTUAL-MTU L2MTU  MAX-L2MTU MAC-ADDRESS
 0  RS ether1                              ether            1500                  50:E7:67:00:37:00
 1  R  ether2                              ether            1500                  50:E7:67:00:37:01
 2  RS ether3                              ether            1500                  50:E7:67:00:37:02
 3  RS ether4                              ether            1500                  50:E7:67:00:37:03
 4  RS ether5                              ether            1500                  50:E7:67:00:37:04
 5  RS ;;; Client Network
       VLAN10                              vlan             1500                  50:E7:67:00:37:01
 6  RS ;;; Server Network
       VLAN20                              vlan             1500                  50:E7:67:00:37:01
 7  R  ;;; VLAN 10 Bridge
       bridge-vlan10                       bridge           1500 65535            50:E7:67:00:37:01
 8  R  ;;; VLAN 20 Bridge
       bridge-vlan20                       bridge           1500 65535            50:E7:67:00:37:01
[admin@MikroTik] /system logging> /ip address print
Flags: X - disabled, I - invalid, D - dynamic
 #   ADDRESS            NETWORK         INTERFACE
 0   ;;; Syslog to Linux SERVER
     172.16.2.254/24    172.16.2.0      ether1
 1   ;;; VLAN10 Gateway
     172.16.1.1/24      172.16.1.0      bridge-vlan10
 2   ;;; VLAN20 Gateway
     172.16.2.1/24      172.16.2.0      bridge-vlan20
[admin@MikroTik] /system logging> /ip route print
Flags: X - disabled, A - active, D - dynamic, C - connect, S - static, r - rip, b - bgp, o - ospf, m - mme,
B - blackhole, U - unreachable, P - prohibit
 #      DST-ADDRESS        PREF-SRC        GATEWAY            DISTANCE
 0   S  ;;; Default via Router 1
        0.0.0.0/0                          172.16.2.254              1
 1 ADC  172.16.1.0/24      172.16.1.1      bridge-vlan10             0
 2 ADC  172.16.2.0/24      172.16.2.254    bridge-vlan20             0
[admin@MikroTik] /system logging> /ping 172.16.2.254 count=5
  SEQ HOST                                     SIZE TTL TIME  STATUS
    0 172.16.2.254                               56  64 0ms
    1 172.16.2.254                               56  64 0ms
    2 172.16.2.254                               56  64 0ms
    3 172.16.2.254                               56  64 0ms
    4 172.16.2.254                               56  64 0ms
    sent=5 received=5 packet-loss=0% min-rtt=0ms avg-rtt=0ms max-rtt=0ms
[admin@MikroTik] /ip address> /user add name=oxidized password=Oxidized123! group=full comment="Oxidized Backup"
[admin@MikroTik] /ip address> /ip service set ssh address=172.16.2.0/24 port=22
[admin@MikroTik] /ip address> /user add name=oxidized password=Oxidized123! group=full comment="Oxidized Backup"
[admin@MikroTik] /ip address> /ip service set ssh address=172.16.2.0/24 port=22

```

---
# Настройка Windows Server

Настройка Ip

![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_09.png?raw=true)

---
Установка AD
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_24.png?raw=true)

---
Создание нового леса
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_24-1.png?raw=true)

---

Смена днс после перезагрузки 
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_40.png?raw=true)

---

создание обратной зоны для vlan20
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_45.png?raw=true)

---

Добавляю узлы
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_48.png?raw=true)![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_49.png?raw=true)

---
Добавляю ptr записи
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_51.png?raw=true)

---
Обратная зона
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_53.png?raw=true)
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-21_53-1.png?raw=true)

---
проверка
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-22_17.png?raw=true)

---

создаем подразделение 
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-22_20.png?raw=true)

создаем пользователя 
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-22_33.png?raw=true)
В итоге я создал вместо этого пользователя, юзера testuser

---
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-22_38.png?raw=true)

---

# Настройка linux server


настройка портов на сервере omv
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-28.10.2025-23_04.png?raw=true)

---

настройка syslog
![Image](https://github.com/sender2033/testwork-protech-Vafin/blob/main/Image/02_%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-29.10.2025-16_15.png?raw=true)

---
Настройка Syslog сервера
![[02_Выполнение задания-29.10.2025-16_20.png]]
![[02_Выполнение задания-29.10.2025-16_21.png]]

---

Настройка Samba
```
root@OMV:~# mkdir -p /srv/samba/homes
root@OMV:~# mkdir -p /srv/samba/share
root@OMV:~# chmod 777 /srv/samba/homes
root@OMV:~# chmod 777 /srv/samba/share
root@OMV:~# ls -la /srv/samba/
итого 16
drwxr-xr-x 4 root root 4096 окт 29 02:07 .
drwxr-xr-x 6 root root 4096 окт 29 02:07 ..
drwxrwxrwx 2 root root 4096 окт 29 02:07 homes
drwxrwxrwx 2 root root 4096 окт 29 02:07 share
root@OMV:~# nano /etc/samba/smb.conf
```

---

Редактирование конфигурации
![[02_Выполнение задания-29.10.2025-18_30.png]]

---

Проверка конфигурации
![[02_Выполнение задания-29.10.2025-18_33.png]]

---

исправление ошибок
![[02_Выполнение задания-29.10.2025-18_36.png]]

![[02_Выполнение задания-29.10.2025-19_11.png]]

---
Проверка коннекта oxidized и роутеров
![[02_Установка OMV, а развёртывание на ней Oxidized-29.10.2025-22_14.png]]

 ---
 
# Настройка клиента
Установка ip
![[02_Выполнение задания-29.10.2025-22_26.png]]

---
Установка hostname
![[02_Выполнение задания-29.10.2025-23_06.png]]
![[02_Выполнение задания-29.10.2025-23_06-1.png]]

---
Установка пакетов для интеграции с AD

![[02_Выполнение задания-29.10.2025-23_08.png]]

---
Настройка Kerberos
![[02_Выполнение задания-29.10.2025-23_11.png]]
![[02_Выполнение задания-29.10.2025-23_12.png]]
![[02_Выполнение задания-29.10.2025-23_12-1.png]]![[02_Выполнение задания-29.10.2025-23_17.png]]

---
Проблемы с DNS и их решение
![[02_Выполнение задания-29.10.2025-23_20.png]]![[02_Выполнение задания-29.10.2025-23_23.png]]
![[02_Выполнение задания-29.10.2025-23_35.png]]

---
Настройка SSSD
![[02_Выполнение задания-29.10.2025-23_42.png]]

---
Просмотр конфигурации
![[02_Выполнение задания-29.10.2025-23_43.png]]
![[02_Выполнение задания-29.10.2025-23_44.png]]

---
sssd не завелось, пробую winbind
![[02_Выполнение задания-30.10.2025-21_49.png]]
![[02_Выполнение задания-30.10.2025-21_51.png]]
настройка PAM
![[02_Выполнение задания-30.10.2025-21_55.png]]![[02_Выполнение задания-30.10.2025-21_57.png]]
Настройка монтирования в nas

```
root@client:/home/erik# sudo mkdir -p /mnt/nas-share
root@client:/home/erik# sudo bash -c 'cat > /root/.smbcredentials << EOF
> username=guest
password=
EOF'
root@client:/home/erik# sudo chmod 600 /root/.smbcredentials
root@client:/home/erik# sudo bash -c 'cat >> /etc/fstab << EOF
> //172.16.2.4/homes    /mnt/nas-homes    cifs    credentials=/root/.smbcredentials,uid=0,gid=0,file_mode=0777,dir_mode=0777,_netdev    0    0
//172.16.2.4/share    /mnt/nas-share    cifs    credentials=/root/.smbcredentials,uid=0,gid=0,file_mode=0777,dir_mode=0777,_netdev    0    0
EOF'
root@client:/home/erik# sudo systemctl daemon-reload

```

Попытки настройки, в результате, успех
```
root@client:/home/erik# df -h | grep nas
//172.16.2.4/share    29G         5,4G   24G           19% /mnt/nas-share
root@client:/home/erik# su - testuser
testuser@client:~$ echo "Local file $(date)" > ~/local-test.txt
testuser@client:~$ echo "NAS file $(date)" > /mnt/nas-share/testuser-test.txt
-bash: /mnt/nas-share/testuser-test.txt: Отказано в доступе
testuser@client:~$ echo "NAS file $(date)" > /mnt/nas-share/testuser-test.txt
-bash: /mnt/nas-share/testuser-test.txt: Отказано в доступе
testuser@client:~$ sudo echo "NAS file $(date)" > /mnt/nas-share/testuser-test.txt
-bash: /mnt/nas-share/testuser-test.txt: Отказано в доступе
testuser@client:~$ ls -la ~
итого 40
drwxr-xr-x 2 testuser domain users 4096 окт 30 22:16 .
drwxr-xr-x 4 root     root         4096 окт 30 21:55 ..
-rw------- 1 testuser domain users  186 окт 30 22:15 .bash_history
-rw-r--r-- 1 testuser domain users  220 окт 30 21:55 .bash_logout
-rw-r--r-- 1 testuser domain users 3526 окт 30 21:55 .bashrc
-rw-r--r-- 1 testuser domain users 5290 окт 30 21:55 .face
lrwxrwxrwx 1 testuser domain users    5 окт 30 21:55 .face.icon -> .face
-rw-r--r-- 1 testuser domain users   44 окт 30 22:16 local-test.txt
-rw-r--r-- 1 testuser domain users  807 окт 30 21:55 .profile
-rw-r--r-- 1 testuser domain users   56 окт 30 21:56 test.txt
testuser@client:~$ ls -la /mnt/nas-share/
итого 8
drwxr-xr-x 2 root root    0 окт 29 19:10 .
drwxr-xr-x 4 root root 4096 окт 30 21:57 ..
-rwxr-xr-x 1 root root   17 окт 29 19:10 test-share.txt
testuser@client:~$ exit
выход
root@client:/home/erik# ls -la /mnt/nas-share/
итого 8
drwxr-xr-x 2 root root    0 окт 29 19:10 .
drwxr-xr-x 4 root root 4096 окт 30 21:57 ..
-rwxr-xr-x 1 root root   17 окт 29 19:10 test-share.txt
root@client:/home/erik# mount | grep nas-share
//172.16.2.4/share on /mnt/nas-share type cifs (rw,relatime,vers=3.0,sec=none,cache=strict,uid=0,noforceuid,gid=0,noforcegid,addr=172.16.2.4,file_mode=0755,dir_mode=0755,soft,nounix,serverino,mapposix,rsize=4194304,wsize=4194304,bsize=1048576,echo_interval=60,actimeo=1,closetimeo=1)
root@client:/home/erik# sudo umount /mnt/nas-share
root@client:/home/erik# sudo mount -t cifs //172.16.2.4/share /mnt/nas-share -o guest,vers=3.0,noperm
root@client:/home/erik# ls -la /mnt/nas-share/
итого 8
drwxr-xr-x 2 root root    0 окт 29 19:10 .
drwxr-xr-x 4 root root 4096 окт 30 21:57 ..
-rwxr-xr-x 1 root root   17 окт 29 19:10 test-share.txt
root@client:/home/erik# echo "test" > /mnt/nas-share/root-test.txt
root@client:/home/erik# ls -la /mnt/nas-share/
итого 12
drwxr-xr-x 2 root root    0 окт 30 22:20 .
drwxr-xr-x 4 root root 4096 окт 30 21:57 ..
-rwxr-xr-x 1 root root    5 окт 30 22:20 root-test.txt
-rwxr-xr-x 1 root root   17 окт 29 19:10 test-share.txt
root@client:/home/erik# id testuser
uid=1001109(testuser) gid=1000513(domain users) группы=1000513(domain users),27(sudo),1001109(testuser),1001105(linuxadmins)
root@client:/home/erik# sudo umount /mnt/nas-share
root@client:/home/erik# sudo mount -t cifs //172.16.2.4/share /mnt/nas-share -o
mount: ключ должен использоваться с аргументом — «o»
Try 'mount --help' for more information.
root@client:/home/erik# sudo mount -t cifs //172.16.2.4/share /mnt/nas-share -o guest,vers=3.0,uid=1001109,gid=1000513,file_mode=0664,dir_mode=0775
root@client:/home/erik# sudo umount /mnt/nas-share
root@client:/home/erik# sudo mount -t cifs //172.16.2.4/share /mnt/nas-share -o guest,vers=3.0,noperm
root@client:/home/erik# ls -la /mnt/nas-share/
итого 12
drwxr-xr-x 2 root root    0 окт 30 22:20 .
drwxr-xr-x 4 root root 4096 окт 30 21:57 ..
-rwxr-xr-x 1 root root    5 окт 30 22:20 root-test.txt
-rwxr-xr-x 1 root root   17 окт 29 19:10 test-share.txt
root@client:/home/erik# cat /mnt/nas-share/nas-created.txt
cat: /mnt/nas-share/nas-created.txt: Нет такого файла или каталога
root@client:/home/erik# su - testuser
testuser@client:~$ echo "Test from testuser" > /mnt/nas-share/testuser-file.txt
testuser@client:~$ ls -la /mnt/nas-share/
итого 16
drwxr-xr-x 2 root root    0 окт 30 22:22 .
drwxr-xr-x 4 root root 4096 окт 30 21:57 ..
-rwxr-xr-x 1 root root    5 окт 30 22:20 root-test.txt
-rwxr-xr-x 1 root root   17 окт 29 19:10 test-share.txt
-rwxr-xr-x 1 root root   19 окт 30 22:22 testuser-file.txt
testuser@client:~$ ^C
testuser@client:~$

```
![[02_Выполнение задания-30.10.2025-22_23.png]]


Доказательство работы
 Успешный вход пользователя
![[02_Выполнение задания-30.10.2025-22_32.png]]

Рабочее окружение пользователя
![[02_Выполнение задания-30.10.2025-22_33.png]]

Файлы пользователя на NAS (со стороны Client)**
![[02_Выполнение задания-30.10.2025-22_34.png]]

Файлы на NAS сервере (доказательство хранения)**
![[02_Выполнение задания-30.10.2025-22_34-1.png]]

Конфиг Router 1 - Wan
```
# oct/30/2025 19:36:36 by RouterOS 6.49.7
# software id =
#
#
#
/interface vlan
add comment="Client Network Trunk" interface=ether2 name=VLAN10 vlan-id=10
add comment="Server Network Trunk" interface=ether2 name=VLAN20 vlan-id=20
/interface wireless security-profiles
set [ find default=yes ] supplicant-identity=MikroTik
/ip address
add address=172.16.2.250/24 comment=Management interface=VLAN20 network=\
    172.16.2.0
/ip dhcp-client
add disabled=no interface=ether1
/ip dns
set allow-remote-requests=yes servers=8.8.8.8,1.1.1.1
/ip firewall filter
add action=accept chain=forward comment="Allow established" connection-state=\
    established,related
add action=accept chain=forward comment="VLAN10 to Internet" in-interface=\
    VLAN10 out-interface=ether1
add action=accept chain=forward comment="VLAN20 to Internet" in-interface=\
    VLAN20 out-interface=ether1
add action=accept chain=forward comment="VLAN10 to VLAN20" in-interface=\
    VLAN10 out-interface=VLAN20
add action=accept chain=forward comment="VLAN20 to VLAN10" in-interface=\
    VLAN20 out-interface=VLAN10
/ip firewall nat
add action=masquerade chain=srcnat comment="NAT to Internet" out-interface=\
    ether1
/ip route
add comment="VLAN10 via Router2" distance=1 dst-address=172.16.1.0/24 \
    gateway=172.16.2.1
/ip service
set telnet disabled=yes
set ssh address=172.16.2.0/24

```

конфиг Router 2 - Core
```
# oct/30/2025 19:36:59 by RouterOS 6.49.7
# software id =
#
#
#
/interface bridge
add comment="VLAN 10 Bridge" name=bridge-vlan10
add comment="VLAN 20 Bridge" name=bridge-vlan20
/interface vlan
add comment="Client Network" interface=ether2 name=VLAN10 vlan-id=10
add comment="Server Network" interface=ether2 name=VLAN20 vlan-id=20
/interface wireless security-profiles
set [ find default=yes ] supplicant-identity=MikroTik
/system logging action
add name=remote1 remote=172.16.2.3 target=remote
/interface bridge port
add bridge=bridge-vlan10 interface=VLAN10
add bridge=bridge-vlan10 comment="Linux Client 1" interface=ether3
add bridge=bridge-vlan20 interface=VLAN20
add bridge=bridge-vlan20 comment="Windows Server" interface=ether4
add bridge=bridge-vlan20 comment="Linux SERVER e1" interface=ether5
add bridge=bridge-vlan20 comment="Linux SERVER e0 Syslog" interface=ether1
/ip address
add address=172.16.2.254/24 comment="Syslog to Linux SERVER" interface=ether1 \
    network=172.16.2.0
add address=172.16.1.1/24 comment="VLAN10 Gateway" interface=bridge-vlan10 \
    network=172.16.1.0
add address=172.16.2.1/24 comment="VLAN20 Gateway" interface=bridge-vlan20 \
    network=172.16.2.0
/ip dhcp-client
# DHCP client can not run on slave interface!
add disabled=no interface=ether1
/ip dns
set allow-remote-requests=yes servers=172.16.2.2
/ip firewall filter
add action=accept chain=forward comment="Allow all forward"
/ip firewall nat
# in/out-interface matcher not possible when interface (ether1) is slave - use master instead (bridge-vlan20)
add action=masquerade chain=srcnat out-interface=ether1
/ip route
add comment="Default via Router 1" distance=1 gateway=172.16.2.250
/ip service
set ssh address=172.16.2.0/24
/system logging
add action=remote1 topics=info,!debug
add action=remote1 topics=warning
add action=remote1 topics=error
add action=remote1 topics=critical

```